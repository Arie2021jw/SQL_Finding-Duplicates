Exercise 1: Concatenating different addresses located on separate rows associated to a BusinessEntityID into one row

Solution #1:

  Query #1:

SELECT X.BusinessEntityID
, X.FirstName
, X.MiddleName
, X.LastName
, STRING_AGG (X.AddressLine1, ',') AS Addresses
, X.City
, X.StateProvinceCode
, X.StateProvinceName
, X.CountryRegionCode
FROM 
	(
	SELECT Person.BusinessEntityID				-- OriginalTablesFilteredLevel2
	, Person.FirstName
	, Person.MiddleName
	, Person.LastName
	, PersonAddress.AddressID
	, PersonAddress.AddressLine1
	, PhoneNumber.PhoneNumber
	, PersonAddress.City
	, PersonAddress.StateProvinceID
	, StateID.StateProvinceCode
	, StateID.Name AS StateProvinceName
	, StateID.TerritoryID
	, SalesTerritory.Name AS TerritoryName
	, SalesTerritory.CountryRegionCode 
	FROM [AdventureWorks2022].[Person].[Person] AS Person
	LEFT JOIN [AdventureWorks2022].[Person].[BusinessEntityAddress] AS BEAddress
		ON Person.BusinessEntityID = BEAddress.BusinessEntityID
	LEFT JOIN [AdventureWorks2022].[Person].[Address] AS PersonAddress
		ON BEAddress.AddressID = PersonAddress.AddressID
	LEFT JOIN [AdventureWorks2022].[Person].[PersonPhone] AS PhoneNumber
		ON Person.BusinessEntityID = PhoneNumber.BusinessEntityID
	LEFT JOIN [AdventureWorks2022].[Person].[StateProvince] AS StateID
		ON PersonAddress.StateProvinceID = StateID.StateProvinceID
	LEFT JOIN [AdventureWorks2022].[Sales].[SalesTerritory] AS SalesTerritory
		ON StateID.TerritoryID = SalesTerritory.TerritoryID
	WHERE Person.BusinessEntityID IN 
		(
		SELECT Person.BusinessEntityID								-- FilterDuplicatesLevel1
		FROM [AdventureWorks2022].[Person].[Person] AS Person
		LEFT JOIN [AdventureWorks2022].[Person].[BusinessEntityAddress] AS BEAddress
			ON Person.BusinessEntityID = BEAddress.BusinessEntityID
		GROUP BY Person.BusinessEntityID
		HAVING COUNT(*) > 1									-- FilterDuplicatesLevel1
		)										-- OriginalTablesFilteredLevel2
	) AS X
GROUP BY X.BusinessEntityID, X.FirstName, X.MiddleName, X.LastName, X.City, X.StateProvinceCode, X.StateProvinceName, X.CountryRegionCode



BusinessEntityID		FirstName		    MiddleName		  LastName		Addresses			City		StateProvinceCode		StateProvinceName		CountryRegionCode
2996					      Amanda		      S		Cook		      4098 Woodcrest Dr.,9187 Vista Del Sol			Everett		WA 		Washington		US
4073					      Miguel		      NULL		        Miller		6696 Anchor Drive			Bothell		WA 		Washington		US
4073					      Miguel		      NULL		        Miller		4293 Concord Ct.			Everett		WA 		Washington		US
4388					      Osarumwense		  Uwaifiokun		  Agbonile		1873 Lion Circle			Bothell		WA 		Washington		US
4388					      Osarumwense		  Uwaifiokun		  Agbonile		3858 Vista Diablo			Issaquah		WA 		Washington		US
5124					      Karl		        V		Xie		4039 Elkwood Dr.			Ballard		WA 		Washington		US
5124					      Karl		        V		Xie		4912 La Vuelta			Bothell		WA 		Washington		US
5479					      Luis		        NULL		Shan		500 35th Ave NE,3993 Jabber Place			Los Angeles		CA 		California		US
5561					      Caleb		        NULL		Alexander		1261 Viking Drive			Everett		WA 		Washington		US
5561					      Caleb		       NULL		Alexander		4775 Kentucky Dr.			Monroe		WA 		Washington		US
5668					      Jose		       M		Hayes		3141 Jabber Place			Ballard		WA 		Washington		US
5668					      Jose		      M		Hayes		793 Crawford Street			Kenmore		WA 		Washington		US
5976					      Nathan		    D		Chen		2238 Pine Street			Issaquah		WA 		Washington		US
5976					      Nathan		    D		Chen		2095 Sierra Drive			Sammamish		WA 		Washington		US




